package logica;

import java.time.LocalDate;
import java.time.LocalTime;
import java.util.ArrayList;
import java.util.Random;
import modelo.Anomalia;
import modelo.Dron;
import modelo.Registro;

/**
 * Clase que representa el centro de inteligencia encargado de registrar
 * las decisiones tomadas ante anomalías detectadas por los drones.
 * Permite crear registros de acciones y almacenar un historial de decisiones.
 */
public class CInteligencia {

    /** Lista de registros de decisiones tomadas ante anomalías. */
    private ArrayList<Registro> listaRegistros;

    /**
     * Constructor que inicializa la lista de registros.
     */
    public CInteligencia() {
        listaRegistros = new ArrayList<>();
    }

    /**
     * Obtiene la lista de registros almacenados.
     * @return Lista de registros.
     */
    public ArrayList<Registro> getListaRegistros() {
        return listaRegistros;
    }

    // ----------------------------------------------------------------------------------------------------
    // Funciones principales

    /**
     * Selecciona aleatoriamente una acción de la lista de acciones disponibles
     * para la anomalía detectada.
     * @param anomaliaDetectada La anomalía para la cual se debe tomar una acción.
     * @return La acción seleccionada aleatoriamente.
     */
    public String tomarDesicion(Anomalia anomaliaDetectada) {
        Random rand = new Random();
        int largo = anomaliaDetectada.getListaAcciones().size();
        int index = rand.nextInt(largo);
        return anomaliaDetectada.getListaAcciones().get(index);
    }

    /**
     * Crea un registro de acción tomada por un dron ante una anomalía.
     * Desactiva la anomalía después de registrar la acción.
     * @param anomaliaDetectada La anomalía detectada.
     * @param dron El dron que detectó la anomalía y ejecutó la acción.
     * @return true siempre que se registre correctamente.
     */
    public boolean crearRegistro(Anomalia anomaliaDetectada, Dron dron) {
        String accionTomada = tomarDesicion(anomaliaDetectada);
        Registro registro = new Registro(LocalDate.now(), LocalTime.now(), anomaliaDetectada.getTipoAnomalia(), dron, accionTomada);
        listaRegistros.add(registro);
        anomaliaDetectada.setAnomaliaActiva(false);
        return true;
    }

    /**
     * Representación en String de todos los registros de decisiones.
     * @return String con la lista de registros.
     */
    @Override
    public String toString() {
        return "Lista de Registros: " + listaRegistros;
    }
}
